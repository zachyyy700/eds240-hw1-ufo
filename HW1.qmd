---
title: "HW #1"
subtitle: "Interpreting `{ggplot2}` code"
description: "Assigned Wed 01/07/2026 | Due Wed 01/14/2026"
author: "Zach Loo"
toc: true
editor_options: 
  chunk_output_type: console
---

::: callout-tip
## Some notes before you get started

-   **Be sure to install any packages** in the Setup chunk that you don't already have.
-   **Leave the code chunk options, `eval: false` and `echo: true`, set as they are.** The final infographic has been intentionally optimized (e.g., text size, spacing) for saving and viewing as a PNG file, not for display in the Plots pane or within a rendered Quarto document. As a result, the text in each individual ggplot may appear too large when viewed in the Plots pane, but will be correctly sized in the exported PNG. We’ll talk more about the nuances of saving ggplots (and why these differences occur) in a later lab section.
-   Some answers may become clearer once you’ve looked ahead at the code further down in the script. **Consider revisiting questions as you go.**
:::

## I. Setup

```{r}
#| eval: false
#| echo: true

library(colorspace)
library(geofacet) 
library(ggtext) 
library(glue) 
library(grid)
library(magick)
library(patchwork) 
library(scales) 
library(showtext) 
library(tidyverse) 

ufo_sightings <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-06-20/ufo_sightings.csv')
places <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-06-20/places.csv')

alien <- c("#101319", "#28ee85")
bg <- alien[1]
accent <- alien[2]

ufo_image <- magick::image_read(path = here::here("images", "ufo.png")) 

sysfonts::font_add_google(name = "Orbitron", family = "orb")
sysfonts::font_add_google(name = "Barlow", family = "bar")

sysfonts::font_add(family = "fa-brands", regular = here::here("fonts", "Font Awesome 6 Brands-Regular-400.otf"))
sysfonts::font_add(family = "fa-solid", regular = here::here("fonts", "Font Awesome 6 Free-Solid-900.otf"))

showtext::showtext_auto(enable = TRUE)
```

1.  **What is the author defining in lines 15-17? Where else in the code do these defined variables show up? What advantage(s) is there to defining these values here, as variables, rather than defining the values directly throughout the script?**

    -   The author is defining a dataframe object, created by reading a csv file. Later in the code, these defined variables are manipulated with data wrangling techniques such as `dplyr::filter()` and `mutate()`. The advantage of defining these variables at the start is now we can reference the entire dataframe line: `read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-06-20/ufo_sightings.csv')` with a single word.

2.  **In your own words, explain what the function, `font_add_google()`, does. What's the difference between the two arguments, `name` and `family`?**

    -   The function `font_add_google()` is from the `sysfonts` package and allows us to use fonts from Google Fonts. The first argument `name`, is where the font name from Google Fonts is specified. This argument is required and has no default. The second argument `family`, is optional as its default value is the `name` argument itself.

## II. Data wrangling

### i. Create `df_pop`

```{r}
#| eval: false
#| echo: true

df_pop <- places |>
  filter(country_code == "US") |>
  mutate(state = str_replace(string = state,
                             pattern = "Fl",
                             replacement = "FL")) |> 
  group_by(state) |>
  summarise(pop = sum(population)) |>
  ungroup()
```

3.  **Describe what this data frame contains.**

    -   This dataframe contains all 50 US states (by two-letter abbreviation) plus the District of Columbia (DC) and their respective population.

### ii. Create `df_us`

```{r}
#| eval: false
#| echo: true

df_us <- ufo_sightings |>
  filter(country_code == "US") |>
  mutate(state = str_replace(string = state,
                             pattern = "Fl",
                             replacement = "FL")) |> 
  count(state) |>
  left_join(df_pop, by = "state") |>
  rename(num_obs = n) |> 
  mutate(
    num_obs_per10k = num_obs / pop * 10000,
    opacity_val = num_obs_per10k / max(num_obs_per10k)
    )
```

4.  **Describe what this data frame contains.**

    -   This dataframe is a joined dataframe between the previous population dataframe and ufo sightings data which contains information on ufo sightings in the US like reported sighting date, duration, shape, etc. As a result, the `df_us` dataframe contains ufo sightings per US state, the population of each state, and number of ufo sightings per 10,000 people.

5.  **What does `opacity_val` represent, and why is it calculated?**

    -   This variable will be used later in the final visualization and will represent a relative opacity value based on number of ufo sightings per 10,000.

### iii. Create `df_shape`

```{r}
#| eval: false
#| echo: true

df_shape <- ufo_sightings |>
  filter(!shape %in% c("unknown", "other")) |>
  count(shape) |>
  rename(total_sightings = n) |> 
  arrange(desc(total_sightings)) |>
  slice_head(n = 10) |>
  mutate(
    shape = fct_reorder(.f = shape, 
                        .x = total_sightings), 
    opacity_val = scales::rescale(x = total_sightings, 
                                  to = c(0.3, 1))
    )
```

6.  **Describe what this data frame contains.**

    -   This dataframe contains the top 10 most reported shapes of ufos and their counts. Additionally, there is a `opacity_val` variable again which represents the relative frequency of the reported shapes.

7.  **What does `fct_reorder` do when it is applied to the `shape` variable? What would have happened if this step was not performed?**

    -   This reorders the shape column based on values in the `total_sightings` column. Without this step, the `shape` variable would be in alphabetical order.

8.  **What is the purpose of rescaling `opacity_val`? And why rescale from 0.3 to 1?**

    -   Rescaling to `opacity_val` is essentially "translating" the `total_sightings` continuous scale into another from 0-1, keeping relative relationships. Since `total_sightings` will be visually described with `opacity_val`, we need `opacity_val` to be from 0-1, but also start from 0.3 since values close to 0 are transparent & too hard to see.

### iv. Create `df_day_hour`

```{r}
#| eval: false
#| echo: true

df_day_hour <- ufo_sightings |>
  mutate(
    day = wday(reported_date_time), 
    hour = hour(reported_date_time), 
    wday = wday(reported_date_time, label = TRUE) 
  ) |>
  count(day, wday, hour) |>
  rename(total_daily_obs = n) |> 
  mutate(
    opacity_val = total_daily_obs / max(total_daily_obs),
    hour_lab = case_when(
      hour == 0 ~ "12am",
      hour <= 12 ~ paste0(hour, "am"),
      hour == 12 ~ "12pm",
      TRUE ~ paste0(hour - 12, "pm")) 
    )
```

9.  **Describe what this data frame contains.**

    -   This dataframe contains time information on reported ufo sightings like time of day and day of week. Additionally, the amount of sightings for each hour of each day.

10. **What is the purpose of the last line inside the `case_when()` statement (`TRUE ~ paste0(hour - 12, "pm")`)?**

    -   This line catches any cases where the `hour` variable is in 24 hour time (greater than 12) and convert it to "xpm".

## III. Prepare text elements

```{r}
#| eval: false
#| echo: true

quotes <- paste0('"...', str_to_sentence(ufo_sightings$summary[c(47816, 6795, 93833)]), '..."')

original <- glue("Original visualization by Dan Oehm:")
dan_github <- glue("<span style='font-family:fa-brands;'>&#xf09b;</span> doehm/tidytues")
new <- glue("Updated version by Sam Shanny-Csik for EDS 240:")
link <- glue("<span style='font-family:fa-solid;'>&#xf0c1;</span> eds-240-data-viz.github.io")
space <- glue("<span style='color:{bg};'>. .</span>")
caption <- glue("{original}{space}{dan_github}
                <br><br>
                {new}{space}{link}")
```

11. **In your own words, what is the difference between `paste0()` and `glue()`? Why did the author use `paste0` to construct `quotes` and `glue` to construct the other text elements?**

    -   From my understanding, `glue` enables the user to reference variables more easily without needed to add another argument and quotes like in `paste0`. For example the line: `caption <- glue("{original}{space}{dan_github}`, references previously made variables in a more convenient way, especially when combining html components.

## IV. Build plots

### i. Build `plot_shape`

```{r}
#| eval: false
#| echo: true

plot_shape <- ggplot(data = df_shape) +
  geom_col(aes(x = total_sightings, y = shape, alpha = opacity_val), 
           fill = accent) +
  geom_text(aes(x = 200, y = shape, label = str_to_title(shape)), 
            family = "orb", 
            fontface = "bold",
            color = bg, 
            size = 14, 
            hjust = 0,
            nudge_y = 0.2) +
  geom_text(aes(x = total_sightings-200, y = shape, label = scales::comma(total_sightings)),
            family = "orb",
            fontface = "bold",
            color = bg,
            size = 10,
            hjust = 1,
            nudge_y = -0.2) +
  scale_x_continuous(expand = c(0, NA)) +
  labs(subtitle = "10 most commonly reported shapes") +
  theme_void() +
  theme(
    plot.subtitle = element_text(family = "bar", 
                                 size = 40, 
                                 color = accent,
                                 hjust = 0,  
                                 margin = margin(b = 10)),
    legend.position = "none" 
  )
```

12. **Explain the values provided to the `x` aesthetic for both text geoms (`shape` & `total_sightings`).**

    -   The values provided in the `x` aesthetic controls the x position of the text in each bar. Changing the values from 200 to 500, shifts the text horizontally.

### ii. Build `plot_us`

**HINT:** Consider temporarily commenting out / rearranging the `geom_*()` layers to better understand how this plot is constructed

```{r}
#| eval: false
#| echo: true

plot_us <-  ggplot(df_us) +
  geom_rect(aes(xmin = 0, xmax = 1, ymin = 0, ymax = 1, alpha = opacity_val), 
            fill = accent) +
  geom_text(aes(x = 0.5, y = 0.7, label = state), 
            family = "orb", 
            fontface = "bold",
            size = 9, 
            color = bg) +
  geom_text(aes(x = 0.5, y = 0.3, label = round(num_obs_per10k, 1)), 
            family = "orb", 
            fontface = "bold",
            size = 8, 
            color = bg) +  
  geofacet::facet_geo(~state) +
  coord_fixed(ratio = 1) +
  labs(subtitle = "Sightings per 10k population") +
  theme_void() +
  theme(
    strip.text = element_blank(),
    plot.subtitle = element_text(family = "bar", 
                                 size = 40, 
                                 color = accent,
                                 hjust = 1,  
                                 margin = margin(b = 10)),
    legend.position = "none" 
  )
```

13. **Consider the order of `geom_*()` layers in the the above plot (`plot_us`). Why did the author order the layers in this way?**

    -   The `geom_rect()` layer is the green-ish background behind the state & number texts. Therefore, this must be placed first in the ggplot code or else the text would be covered up if placed afterwards.

### iii. Build `plot_day`

```{r}
#| eval: false
#| echo: true

plot_day <- ggplot(data = df_day_hour) +
  geom_tile(aes(x = hour, y = day, alpha = opacity_val), 
            fill = accent, 
            height = 0.9, 
            width = 0.9) +
  geom_text(aes(x = hour, y = 9, label = hour_lab), 
            family = "orb",
            color = accent, 
            size = 10) +
  geom_text(aes(x = 0, y = day, label = str_sub(string = wday, start = 1, end = 1)), 
            family = "orb", 
            fontface = "bold",
            color = bg, 
            size = 8) + 
  ylim(-5, 9) +
  xlim(NA, 23.55) +
  coord_polar() +
  theme_void() +
  theme(
    plot.background = element_rect(fill = bg, color = bg),
    legend.position = "none"
  )
```

14. **This plot includes one-letter labels for each day of the week. How is ths accomplished when week days are written using their three-letter abbreviations (e.g. `Mon`, `Tue`) in the `df_day_hour` data frame?**

    -   This is done with the `str_sub()` function in the `label =` argument, this allows us to extract substrings from a character vector given a start and an end. In this case, the start and end are both 1, so only the first letter of the `wday` variable is extracted onto the label.

15. **What role do the `ylim()` and `xlim()` functions play in shaping a ggplot, and how do they change the visual layout of this particular plot? To better understand their effect, try rerunning the code with each of these lines commented out and observe how the plot’s spacing and composition change.**

    -   In this polar plane, the spacing of the tiles changed. Without the limits, it was more of a filled-in circle, compared to the more donut shaped with the limits.

### iv. Build `quote*`s

A comment from Dan Oehm's original code: "A bit clunky but the path of least resistance."

```{r}
#| eval: false
#| echo: true

quote1 <- ggplot() +
  annotate(geom ="text", 
           x = 0, 
           y = 1, 
           label = str_wrap(string = quotes[1], width = 40),
           family = "bar", 
           fontface = "italic", 
           color = accent, 
           size = 16, 
           hjust = 0, 
           lineheight = 0.4) +
  xlim(0, 1) +
  ylim(0, 1) +
  theme_void() +
  coord_cartesian(clip = "off")

quote2 <- ggplot() +
  annotate(geom = "text", 
           x = 0, 
           y = 1, 
           label = str_wrap(string = quotes[2], width = 25),
           family = "bar", 
           fontface = "italic",
           color = accent, 
           size = 16, 
           hjust = 0,  
           lineheight = 0.4) +
  xlim(0, 1) +
  ylim(0, 1) +
  theme_void() +
  coord_cartesian(clip = "off")

quote3 <- ggplot() +
  annotate(geom = "text", 
           x = 0, 
           y = 1, 
           label = str_wrap(string = quotes[3], width = 25),
           family = "bar", 
           fontface = "italic",
           color = accent, 
           size = 16, 
           hjust = 0,  
           lineheight = 0.4) +
  xlim(0, 1) +
  ylim(0, 1) +
  theme_void() +
  coord_cartesian(clip = "off")
```

16. **Why do you think the author chose to convert these text elements (and also in `plot_ufo`, below!) into ggplot objects (you may consider returning to this question after you've worked your way through all of the code)?**

    -   It seems like it's because of more control with the final customization and layering. It seemed very handy when creating the final plot with `inset_element()` functions.

### v. Build `plot_ufo`

**Note:** Grob stands for **gr**aphical **ob**ject. Each visual element rendered in a a ggplot (e.g. lines, points, axes, entire panels, even images) is represented as a grob. Grobs can be manipulated individually to fully customize plots.

```{r}
#| eval: false
#| echo: true
plot_ufo <- ggplot() +
  annotation_custom(grid::rasterGrob(ufo_image)) +
  theme_void() +
  theme(
    plot.background = element_rect(fill = bg, color = bg) 
  )
```

### vi. Build `plot_base`

```{r}
#| eval: false
#| echo: true

plot_base <- ggplot() +
  labs(
    title = "UFO Sightings",
    subtitle = "Summary of over 88k reported sightings across the US",
    caption = caption
    ) +
  theme_void() +
  theme(
    text = element_text(family = "orb", 
                        size = 48, 
                        lineheight = 0.3, 
                        color = accent),
    plot.background = element_rect(fill = bg, 
                                   color = bg),
    plot.title = element_text(size = 128, 
                              face = "bold", 
                              hjust = 0.5, 
                              margin = margin(b = 10)),
    plot.subtitle = element_text(family = "bar", 
                                 hjust = 0.5, 
                                 margin = margin(b = 20)),
    plot.caption = ggtext::element_markdown(family = "bar",
                                            face = "italic",
                                            color = colorspace::darken(accent, 0.25),
                                            hjust = 0.5,
                                            margin = margin(t = 20)),
    plot.margin = margin(b = 20, t = 50, r = 50, l = 50)
  )
```

17. **Why does the author render `plot.caption` using `ggtext::element_markdown()`, rather than `element_text()` (like he does for rendering `plot.title` and `text`)?**

    -   The plots caption comes from the `caption` object that was created earlier, and it's a line of html not regular quoted text. Similar to how we can use html in READMEs and it will render in markdown, the author had to use a function that can render this html like `ggtext::element_markdown()`.

## V. Assemble & save

```{r}
#| eval: false
#| echo: true

plot_final <- plot_base +
  inset_element(plot_shape, left = 0, right = 1, top = 1, bottom = 0.66) +
  inset_element(plot_us, left = 0.42, right = 1, top = 0.74, bottom = 0.33) +
  inset_element(plot_day, left = 0, right = 0.66, top = 0.4, bottom = 0) +
  inset_element(quote1, left = 0.5, right = 1, top = 0.8, bottom = 0.72) +
  inset_element(quote2, left = 0, right = 1, top = 0.52, bottom = 0.4) +
  inset_element(quote3, left = 0.7, right = 1, top = 0.2, bottom = 0) +
  inset_element(plot_ufo, left = 0.25, right = 0.41, top = 0.23, bottom = 0.17) + 
  plot_annotation(
    theme = theme(
      plot.background = element_rect(fill = bg,
                                     color = bg)
    )
  ) 

ggsave(plot = plot_final, 
       filename = here::here("outputs", "ufo_sightings_infographic.png"), 
       height = 16, 
       width = 10)
```

18. **Explain how `plot_final` is assembled. What do you think is the most challenging aspect of arranging all components into a single plot?**

    -   The final plot was 'built' on top of the base plot we made earlier. The most challenging aspect seems to be playing with all of the positions of the visual elements like plots, quotes, and ufo image.

19. **Can you think of one reason the author may have chosen to separate the construction of `plot_base` and `plot_final`?**

    -   The base plot is kind of acting as a foundation and border at the same time. Since it's the title, subtitle, and the bottom caption, it's acting as the top and bottom border of the infographic and the final plot is adding all of the visuals within the border. It just seems more organized to do it this way rather than having to build the entire thing in one go.

## Answer some final reflective questions

20. **During week 2, we discuss [Choosing the right graphic form](https://eds-240-data-viz.github.io/course-materials/lecture-slides/lecture2.1-choosing-graphic-forms-slides.html#/title-slide). Refer to this lecture when answering the sub-questions, below:**

    a.  **What "perceptual tasks" (from Cleveland & McGill's heirarchy) must the viewer perform to extract information from these visualizations?**

        -   The viewer would compare lengths with the bar plot and shades with the map & time plot. It makes sense to use shades for the latter two plots since there's a lot of information being encoded in the visuals. A viewer won't really care about the exact differences when comparing the states and days along with the time of day. Compared to the bar plot, the top 10 shapes were extracted from the data, so a comparison of lengths conveys this the best, a comparison of positions along a common scale.

    b.  **What task(s) do you think the author wanted to enable or message(s) he wanted to convey with these visualizations (see lecture 2.1, slide 16 for examples)? Be sure to note at least one task / message for each of the three data viz.**

        -   The shapes bar plot contained the top 10 shapes reported as ufos. Since there are only ten, a viewer can easily discern these differences. Additionally, this plot has a large difference between the top 1 (light) and the top 2 (circle), perhaps the author wanted to emphasize this difference of over a two-times amount. The US map contains 51 values, so the average viewer would only be able to extract general, relative trends among the 50 states (+DC). The uniqueness of this plot comes from the arrangement of rectangles being a rough shape of the continental US plus Alaska and Hawaii. This puts these data in spatial context that the average American would (hopefully) be familiar with. The third plot contains 7 x 24 = 168 values to be compared. Again, the author chose to use different shades, so the viewer is able to extract mostly general trends. This makes sense for this visual as well since its main purpose is to emphasize the time of day ufos are sighted, in the dead of night. In-between 5/6pm to 10pm, the circle plot is nearly identical, all dark, no ufos sighted. I think the author also wanted this to resemble a clock, hence the polar coordinates.

    c.  **Name at least one caveat to the "hierarchy of perceptual tasks" that the author employed to achieve a goal(s) you noted in question b?**

        -   Both the last two plots wanted to visualize general trends, the map of US and a 24 hour clock. Using a brighter shade of green to convey 'this rectangle/tile had more data in it" is pretty intuitive to a viewer, making a low hierarchy perceptual task a logical choice.

21. **Describe two elements of this piece that you find visually-pleasing / easy to understand / intuitive. Why?**

    -   The latter two visualizations of the US map and clock stood out to me. The first reason it's something we haven't seen before yet unlike the first bar graph. The second reason is because they're very intuitive to understand because the information takes an overall shape that we're familiar with: the map of the US and a clock. These shapes combined with the opacity indicating the magnitude of whichever rectangle or tile really helps convey the information.

22. **Describe two elements of this piece that you feel could be better presented in a different way. Why?**

    -   First, I noticed that the bottom time "12am" should be "12pm". I thought this was an error with something that I did but I checked with the original infographic and the error is also there. It confused me at first but I think most viewers could figure it out and realize that it should be 12pm instead. Second, the darks in the opacity parts of the visuals are a bit too dark to read. I find myself having to zoom in or really strain to try read the bottom-most bar "Changing" and I feel that all text should be read-able without needing extra effort.

23. **Describe two new things that you learned by interpreting / annotating this code. These could be packages, functions, or even code organizational approaches that you hadn't previously known about or considered.**

    -   First, using `glue()` and html together. This unlocks a whole bunch more customization when it comes to text like font families and color. Second, the base and final plot creation steps. This was a really cool and creative way to build the final plot that I haven't thought of before. Essentially, build the title & caption first, build each visualization and quote, and then fill in the visuals afterwards, adjusting the position of each to your liking.

24. **How, if at all, did you use AI tools to help you interpret this code? Describe your approach to using these tools for this assignment. In what ways was consulting the documentation more (or less) helpful than using AI?**

    -   The one part AI tools helped was with the comparison between `paste0` and `glue`. Looking at these documentations, it wasn't made clear about how they compare. I haven't really used `glue` before so having AI explain the specific example in the code confirmed what I initially thought. Usually if I'm trying to understand some code, I come up with an idea/theory first, and have AI confirm and explain more.